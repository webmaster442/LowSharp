<mah:MetroWindow
    x:Class="LowSharp.Client.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:common="clr-namespace:LowSharp.Client.Common"
    xmlns:commonViews="clr-namespace:LowSharp.Client.Common.Views"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mah="http://metro.mahapps.com/winfx/xaml/controls"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    Title="LowSharp"
    Width="{common:WindowSizeProvider Type=Width}"
    Height="{common:WindowSizeProvider Type=Height}"
    TitleAlignment="Center"
    WindowStartupLocation="CenterScreen"
    mc:Ignorable="d">
    <Window.Resources>
        <commonViews:MenuViewModelStyleSelector x:Key="MenuViewModelStyleSelector" />
    </Window.Resources>
    <Window.InputBindings>
        <KeyBinding
            Key="T"
            Command="{Binding NewTabCommand}"
            Modifiers="Ctrl" />
        <KeyBinding
            Key="F4"
            Command="{Binding ExitAppCommand}"
            Modifiers="Alt" />
    </Window.InputBindings>
    <mah:MetroWindow.LeftWindowCommands>
        <mah:WindowCommands>
            <StackPanel Orientation="Horizontal">
                <Menu
                    Grid.Row="0"
                    Grid.Column="0"
                    Margin="0,0,0,0"
                    VerticalAlignment="Center"
                    Background="Transparent">
                    <MenuItem Header="File">
                        <MenuItem
                            Command="{Binding NewTabCommand}"
                            Header="New tab..."
                            InputGestureText="Ctrl+T" />
                        <Separator />
                        <MenuItem
                            Command="{Binding ExitAppCommand}"
                            Header="Exit"
                            InputGestureText="Alt+F4" />
                    </MenuItem>
                </Menu>
                <Menu
                    VerticalAlignment="Center"
                    Background="Transparent"
                    ItemContainerStyleSelector="{StaticResource MenuViewModelStyleSelector}"
                    ItemsSource="{Binding ActualTabItem.Content.Menus}">
                    <Menu.ItemTemplate>
                        <HierarchicalDataTemplate
                            DataType="{x:Type commonViews:MenuViewModel}"
                            ItemsSource="{Binding Children}">
                            <TextBlock Text="{Binding Header}" />
                        </HierarchicalDataTemplate>
                    </Menu.ItemTemplate>
                </Menu>
            </StackPanel>
        </mah:WindowCommands>
    </mah:MetroWindow.LeftWindowCommands>
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="Auto" />
            <ColumnDefinition />
        </Grid.ColumnDefinitions>
        <TabControl
            Grid.Row="0"
            Grid.ColumnSpan="2"
            IsEnabled="{Binding Client.IsConnected}"
            ItemsSource="{Binding Tabs}"
            SelectedItem="{Binding ActualTabItem}"
            Style="{StaticResource MahApps.Styles.TabControl.VisualStudio}">
            <TabControl.ContentTemplate>
                <DataTemplate>
                    <ContentControl Content="{Binding Content}" />
                </DataTemplate>
            </TabControl.ContentTemplate>
            <TabControl.ItemTemplate>
                <DataTemplate>
                    <TextBlock Text="{Binding TabTitle}" />
                </DataTemplate>
            </TabControl.ItemTemplate>
        </TabControl>
        <StatusBar
            Grid.Row="1"
            Grid.ColumnSpan="1"
            Margin="5"
            HorizontalContentAlignment="Stretch"
            VerticalContentAlignment="Stretch">
            <Menu DockPanel.Dock="Left">
                <MenuItem>
                    <MenuItem.Style>
                        <Style
                            BasedOn="{StaticResource {x:Type MenuItem}}"
                            TargetType="MenuItem">
                            <Style.Triggers>
                                <DataTrigger
                                    Binding="{Binding Client.IsConnected}"
                                    Value="false">
                                    <Setter Property="Header">
                                        <Setter.Value>
                                            <StackPanel Orientation="Horizontal">
                                                <Canvas
                                                    Width="24"
                                                    Height="24">
                                                    <Path
                                                        Data="M13,19H14A1,1 0 0,1 15,20H15.73L13,17.27V19M22,20V21.18L20.82,20H22M21,22.72L19.73,24L17.73,22H15A1,1 0 0,1 14,23H10A1,1 0 0,1 9,22H2V20H9A1,1 0 0,1 10,19H11V17H4A1,1 0 0,1 3,16V12A1,1 0 0,1 4,11H6.73L4.73,9H4A1,1 0 0,1 3,8V7.27L1,5.27L2.28,4L21,22.72M4,3H20A1,1 0 0,1 21,4V8A1,1 0 0,1 20,9H9.82L7,6.18V5H5.82L3.84,3C3.89,3 3.94,3 4,3M20,11A1,1 0 0,1 21,12V16A1,1 0 0,1 20,17H17.82L11.82,11H20M9,7H10V5H9V7M9,15H10V14.27L9,13.27V15M5,13V15H7V13H5Z"
                                                        Fill="{StaticResource Red}" />
                                                </Canvas>
                                                <TextBlock
                                                    Margin="5,0"
                                                    VerticalAlignment="Center"
                                                    Text="Disconnected" />
                                            </StackPanel>
                                        </Setter.Value>
                                    </Setter>
                                </DataTrigger>
                                <DataTrigger
                                    Binding="{Binding Client.IsConnected}"
                                    Value="true">
                                    <Setter Property="Header">
                                        <Setter.Value>
                                            <StackPanel Orientation="Horizontal">
                                                <Canvas
                                                    Width="24"
                                                    Height="24">
                                                    <Path
                                                        Data="M13,19H14A1,1 0 0,1 15,20H22V22H15A1,1 0 0,1 14,23H10A1,1 0 0,1 9,22H2V20H9A1,1 0 0,1 10,19H11V17H4A1,1 0 0,1 3,16V12A1,1 0 0,1 4,11H20A1,1 0 0,1 21,12V16A1,1 0 0,1 20,17H13V19M4,3H20A1,1 0 0,1 21,4V8A1,1 0 0,1 20,9H4A1,1 0 0,1 3,8V4A1,1 0 0,1 4,3M9,7H10V5H9V7M9,15H10V13H9V15M5,5V7H7V5H5M5,13V15H7V13H5Z"
                                                        Fill="{StaticResource Green}" />
                                                </Canvas>
                                                <TextBlock
                                                    Margin="5,0"
                                                    VerticalAlignment="Center"
                                                    Text="Connected" />
                                            </StackPanel>
                                        </Setter.Value>
                                    </Setter>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </MenuItem.Style>
                    <MenuItem
                        Command="{Binding Client.StartAndConnectCommand}"
                        Header="Start &amp; Connect">
                        <MenuItem.Icon>
                            <Canvas
                                Width="24"
                                Height="24">
                                <Path
                                    Data="M10,16.5V7.5L16,12M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z"
                                    Fill="{StaticResource White}" />
                            </Canvas>
                        </MenuItem.Icon>
                        <MenuItem.IsEnabled>
                            <MultiBinding Converter="{common:AndConverter}">
                                <Binding
                                    Converter="{common:NegateConverter}"
                                    Path="Client.IsRunning" />
                                <Binding
                                    Converter="{common:NegateConverter}"
                                    Path="Client.IsConnected" />
                            </MultiBinding>
                        </MenuItem.IsEnabled>
                    </MenuItem>
                    <Separator />
                    <MenuItem
                        Command="{Binding Client.StartCommand}"
                        Header="Start"
                        IsEnabled="{Binding Client.IsRunning, Converter={common:NegateConverter}}">
                        <MenuItem.Icon>
                            <Canvas
                                Width="24"
                                Height="24">
                                <Path
                                    Data="M12,4C14.1,4 16.1,4.8 17.6,6.3C20.7,9.4 20.7,14.5 17.6,17.6C15.8,19.5 13.3,20.2 10.9,19.9L11.4,17.9C13.1,18.1 14.9,17.5 16.2,16.2C18.5,13.9 18.5,10.1 16.2,7.7C15.1,6.6 13.5,6 12,6V10.6L7,5.6L12,0.6V4M6.3,17.6C3.7,15 3.3,11 5.1,7.9L6.6,9.4C5.5,11.6 5.9,14.4 7.8,16.2C8.3,16.7 8.9,17.1 9.6,17.4L9,19.4C8,19 7.1,18.4 6.3,17.6Z"
                                    Fill="{StaticResource White}" />
                            </Canvas>
                        </MenuItem.Icon>
                    </MenuItem>
                    <MenuItem
                        Command="{Binding Client.ConnectCommand}"
                        Header="Connect">
                        <MenuItem.IsEnabled>
                            <MultiBinding Converter="{common:AndConverter}">
                                <Binding
                                    Converter="{common:NegateConverter}"
                                    Path="Client.IsConnected" />
                                <Binding Path="Client.IsRunning" />
                            </MultiBinding>
                        </MenuItem.IsEnabled>
                        <MenuItem.Icon>
                            <Canvas
                                Width="24"
                                Height="24">
                                <Path
                                    Data="M21.4 7.5C22.2 8.3 22.2 9.6 21.4 10.3L18.6 13.1L10.8 5.3L13.6 2.5C14.4 1.7 15.7 1.7 16.4 2.5L18.2 4.3L21.2 1.3L22.6 2.7L19.6 5.7L21.4 7.5M15.6 13.3L14.2 11.9L11.4 14.7L9.3 12.6L12.1 9.8L10.7 8.4L7.9 11.2L6.4 9.8L3.6 12.6C2.8 13.4 2.8 14.7 3.6 15.4L5.4 17.2L1.4 21.2L2.8 22.6L6.8 18.6L8.6 20.4C9.4 21.2 10.7 21.2 11.4 20.4L14.2 17.6L12.8 16.2L15.6 13.3Z"
                                    Fill="{StaticResource White}" />
                            </Canvas>
                        </MenuItem.Icon>
                    </MenuItem>
                    <Separator />
                    <MenuItem Header="Options">
                        <MenuItem.Icon>
                            <Canvas
                                Width="24"
                                Height="24">
                                <Path
                                    Data="M12,8A4,4 0 0,1 16,12A4,4 0 0,1 12,16A4,4 0 0,1 8,12A4,4 0 0,1 12,8M12,10A2,2 0 0,0 10,12A2,2 0 0,0 12,14A2,2 0 0,0 14,12A2,2 0 0,0 12,10M10,22C9.75,22 9.54,21.82 9.5,21.58L9.13,18.93C8.5,18.68 7.96,18.34 7.44,17.94L4.95,18.95C4.73,19.03 4.46,18.95 4.34,18.73L2.34,15.27C2.21,15.05 2.27,14.78 2.46,14.63L4.57,12.97L4.5,12L4.57,11L2.46,9.37C2.27,9.22 2.21,8.95 2.34,8.73L4.34,5.27C4.46,5.05 4.73,4.96 4.95,5.05L7.44,6.05C7.96,5.66 8.5,5.32 9.13,5.07L9.5,2.42C9.54,2.18 9.75,2 10,2H14C14.25,2 14.46,2.18 14.5,2.42L14.87,5.07C15.5,5.32 16.04,5.66 16.56,6.05L19.05,5.05C19.27,4.96 19.54,5.05 19.66,5.27L21.66,8.73C21.79,8.95 21.73,9.22 21.54,9.37L19.43,11L19.5,12L19.43,13L21.54,14.63C21.73,14.78 21.79,15.05 21.66,15.27L19.66,18.73C19.54,18.95 19.27,19.04 19.05,18.95L16.56,17.95C16.04,18.34 15.5,18.68 14.87,18.93L14.5,21.58C14.46,21.82 14.25,22 14,22H10M11.25,4L10.88,6.61C9.68,6.86 8.62,7.5 7.85,8.39L5.44,7.35L4.69,8.65L6.8,10.2C6.4,11.37 6.4,12.64 6.8,13.8L4.68,15.36L5.43,16.66L7.86,15.62C8.63,16.5 9.68,17.14 10.87,17.38L11.24,20H12.76L13.13,17.39C14.32,17.14 15.37,16.5 16.14,15.62L18.57,16.66L19.32,15.36L17.2,13.81C17.6,12.64 17.6,11.37 17.2,10.2L19.31,8.65L18.56,7.35L16.15,8.39C15.38,7.5 14.32,6.86 13.12,6.62L12.75,4H11.25Z"
                                    Fill="{StaticResource White}" />
                            </Canvas>
                        </MenuItem.Icon>
                        <MenuItem
                            Command="{Binding Client.InvalidateCacheCommand}"
                            Header="Invalidate Cache"
                            IsEnabled="{Binding Client.IsConnected}">
                            <MenuItem.Icon>
                                <Canvas
                                    Width="24"
                                    Height="24">
                                    <Path
                                        Data="M9,3V4H4V6H5V19A2,2 0 0,0 7,21H17A2,2 0 0,0 19,19V6H20V4H15V3H9M7,6H17V19H7V6M9,8V17H11V8H9M13,8V17H15V8H13Z"
                                        Fill="{StaticResource White}" />
                                </Canvas>
                            </MenuItem.Icon>
                        </MenuItem>
                    </MenuItem>
                    <Separator />
                    <MenuItem
                        Command="{Binding Client.StopCommand}"
                        Header="Stop"
                        IsEnabled="{Binding Client.IsRunning}">
                        <MenuItem.Icon>
                            <Canvas
                                Width="24"
                                Height="24">
                                <Path
                                    Data="M8.27,3L3,8.27V15.73L8.27,21H15.73C17.5,19.24 21,15.73 21,15.73V8.27L15.73,3M9.1,5H14.9L19,9.1V14.9L14.9,19H9.1L5,14.9V9.1M9.12,7.71L7.71,9.12L10.59,12L7.71,14.88L9.12,16.29L12,13.41L14.88,16.29L16.29,14.88L13.41,12L16.29,9.12L14.88,7.71L12,10.59"
                                    Fill="{StaticResource White}" />
                            </Canvas>
                        </MenuItem.Icon>
                    </MenuItem>
                </MenuItem>
            </Menu>
            <TextBlock
                Margin="10,0"
                VerticalAlignment="Center"
                DockPanel.Dock="Left"
                Text="Text Size:" />
            <ComboBox
                Width="70"
                DockPanel.Dock="Left"
                ItemsSource="{Binding ZoomLevels}"
                SelectedItem="{Binding ActualZoomLevel}">
                <ComboBox.ItemTemplate>
                    <DataTemplate>
                        <TextBlock Text="{Binding Converter={common:ZoomLevelToTextConverter}}" />
                    </DataTemplate>
                </ComboBox.ItemTemplate>
            </ComboBox>
            <ProgressBar
                Width="200"
                Height="20"
                Margin="5,0"
                DockPanel.Dock="Left"
                IsIndeterminate="True"
                Visibility="{Binding Client.IsBusy, Converter={common:VisibilityConverter}}" />
        </StatusBar>
        <TextBlock
            VerticalAlignment="Center"
            FontSize="16"
            HorizontalAlignment="Right"
            x:Name="Notification"
            Grid.Row="1"
            Grid.Column="1"
            Margin="10,0"
            Text="{Binding Notifications.Latest}" />
    </Grid>
</mah:MetroWindow>

