syntax = "proto3";

package lowsharp.apiv1.lowering;

option csharp_namespace = "LowSharp.ApiV1.Lowering";

service Lowerer {
  rpc ToLowerCode(LoweringRequest) returns (LoweringResponse);
}

// ToLowerCode types

enum InputLanguage {
  INPUT_LANGUAGE_UNSPECIFIED = 0;
  INPUT_LANGUAGE_CSHARP = 1;
  INPUT_LANGUAGE_VISUALBASIC = 2;
  INPUT_LANGUAGE_FSHARP = 3;
}

enum Optimization {
  OPTIMIZATION_UNSPECIFIED = 0;
  OPTIMIZATION_DEBUG = 1;
  OPTIMIZATION_RELEASE = 2;
}

enum OutputCodeType {
  OUTPUT_CODE_TYPE_UNSPECIFIED = 0;
  OUTPUT_CODE_TYPE_IL = 1;
  OUTPUT_CODE_TYPE_LOWEREDCSHARP = 2;
  OUTPUT_CODE_TYPE_JITASM = 3;
  OUTPUT_CODE_TYPE_SYNTAXTREEJSON = 4;
  OUTPUT_CODE_TYPE_NONMOML = 5;
}

enum DiagnosticSeverity {
  DIAGNOSTIC_SEVERITY_UNSPECIFIED = 0;
  DIAGNOSTIC_SEVERITY_INFO = 1;
  DIAGNOSTIC_SEVERITY_WARNING = 2;
  DIAGNOSTIC_SEVERITY_ERROR = 3;
}

message Diagnostic {
  string message = 1;
  DiagnosticSeverity severity = 2;
}

message LoweringRequest {
  string code = 1;
  InputLanguage language = 2;
  Optimization optimization_level = 3;
  OutputCodeType output_type = 4;
}

message LoweringResponse {
  string result_code = 1;
  repeated Diagnostic diagnostics = 2;
}
